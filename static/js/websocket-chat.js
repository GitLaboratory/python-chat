// Generated by CoffeeScript 1.6.3
(function() {
  $(document).ready(function() {
    var ws;
    ws = new WebSocket("ws://" + location.host + "/api");
    ws.onmessage = function(event) {
      var data, msg, _i, _len, _ref;
      data = JSON.parse(event.data);
      console.log(data);
      switch (data.type) {
        case 'online':
          return $('#members').append("<p class=\"msg\"><span>[" + data.messages[0].datetime + "]</span> <img src=\"http://www.gravatar.com/avatar/" + data.messages[0].cid + "?s=15&d=identicon&f=y\" /></p>");
        case 'offline':
          return console.log(data);
        case 'message':
          _ref = data.messages;
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            msg = _ref[_i];
            $('#logs').append("<p class=\"msg\"><span>[" + msg.datetime + "]</span> <img src=\"http://www.gravatar.com/avatar/" + msg.cid + "?s=15&d=identicon&f=y\" /> <span>:</span>" + msg.body + "</p>");
          }
          return $('#logs').animate({
            scrollTop: $('#logs')[0].scrollHeight
          }, "300", "swing");
      }
    };
    $('form').submit(function(event) {
      var msg;
      msg = $('#message-input').val();
      if (msg.length > 0) {
        ws.send(msg);
        $('#message-input').val("");
      }
      return false;
    });
    return false;
  });

}).call(this);

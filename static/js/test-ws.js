// Generated by CoffeeScript 1.6.3
$(document).ready(function() {
  var rooms, ws;
  rooms = [];
  ws = new WebSocket("ws://" + location.hostname + ":9000");
  ws.onmessage = function(message) {
    var data, msg, rid, _i, _len, _ref, _results;
    data = JSON.parse(message.data);
    console.log(data);
    switch (data.path) {
      case 'create_client':
        msg = {
          path: 'online'
        };
        msg.token = data.token;
        return ws.send(JSON.stringify(msg));
      case 'online':
        msg = {
          path: 'rooms'
        };
        return ws.send(JSON.stringify(msg));
      case 'rooms':
        _ref = data.rooms;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          rid = _ref[_i];
          rooms.push(rid);
          msg = {
            path: 'connect'
          };
          msg.type = 'room';
          msg.id = rid;
          _results.push(ws.send(JSON.stringify(msg)));
        }
        return _results;
        break;
      case 'connect':
        msg = {
          path: 'message'
        };
        msg.type = data.type;
        msg.id = data.id;
        msg.body = "From: " + data.id;
        return ws.send(JSON.stringify(msg));
      case 'message':
        return console.log('Message.type:', data.type);
    }
  };
  return ws.onopen = function() {
    return ws.send(JSON.stringify({
      path: 'create_client'
    }));
  };
});

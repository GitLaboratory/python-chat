// Generated by CoffeeScript 1.6.3
$(document).ready(function() {
    var chatApp, members, messages, ws;
    members = {};
    messages = [];
    ws = new WebSocket("ws://" + location.host + "/api");
    ws.onmessage = function(event) {
        var cid, data, datetime;
        data = JSON.parse(event.data);
        console.log(data);
        switch (data.type) {
        case 'online':
            cid = data.messages[0].cid;
            datetime = data.messages[0].cid;
            members[cid] = {
                'datetime': datetime
            };
            break;
        case 'offline':
            cid = data.messages[0].cid;
            datetime = data.messages[0].cid;
            delete members[cid];
            break;
        case 'message':
            messages.concat(data.messages);
            $('#logs').animate({
                scrollTop: $('#logs')[0].scrollHeight
            }, "300", "swing");
        }
        return 'ok';
    };
    $('form').submit(function(event) {
        var msg;
        msg = $('#message-input').val();
        if (msg.length > 0) {
            ws.send(msg);
            $('#message-input').val("");
        }
        return false;
    });
    chatApp = angular.module("chatApp", []);
    return chatApp.controller("Ctrl", [
        '$scope', function($scope) {
            $scope.templateUrl = "/static/partials/chat.html";
            $scope.messages = messages;
            return $scope.members = members;
        }
    ]);
});
